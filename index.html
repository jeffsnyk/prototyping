<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snyk IDE Plugin Mockup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1e2229;
        }

        /* Custom background to match screenshot */
        .bg-custom-dark {
            background-color: #2d333b;
        }

        .bg-custom-darker {
            background-color: #1e2229;
        }

        .border-custom-line {
            border-color: #2d333b;
        }

        /* Tooltip styles */
        .has-tooltip:hover .tooltip {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Style for active workflow button */
        .workflow-active {
            opacity: 1 !important;
            color: #fff !important;
        }
    </style>
</head>

<body class="bg-custom-darker text-gray-300">

    <!-- Main container for the plugin UI -->
    <div class="w-full h-screen flex flex-col">

        <!-- Header for settings -->
        <header class="p-2 border-b border-custom-line flex justify-between items-center">
            <span class="text-sm font-bold text-white pl-2">SNYK</span>
            <div class="flex items-center space-x-4 pr-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="text-gray-400 hover:text-white cursor-pointer">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="text-gray-400 hover:text-white cursor-pointer">
                    <path d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                    <path
                        d="M10.47 4.32c.602-1.306 2.458-1.306 3.06 0l.218.473a1.684 1.684 0 0 0 2.112.875l.49-.18c1.348-.498 2.66.814 2.162 2.163l-.18.489a1.684 1.684 0 0 0 .875 2.112l.474.218c1.305.602 1.305 2.458 0 3.06l-.474.218a1.684 1.684 0 0 0-.875 2.112l.18.49c.498 1.348-.814 2.66-2.163 2.162l-.489-.18a1.684 1.684 0 0 0-2.112.875l-.218.473c-.602 1.306-2.458 1.306-3.06 0l-.218-.473a1.684 1.684 0 0 0-2.112-.875l-.49.18c-1.348.498-2.66-.814-2.163-2.163l.181-.489a1.684 1.684 0 0 0-.875-2.112l-.474-.218c-1.305-.602-1.305-2.458 0-3.06l.474-.218a1.684 1.684 0 0 0 .875-2.112l-.18-.49c-.498-1.348.814-2.66 2.163-2.163l.489.181a1.684 1.684 0 0 0 2.112-.875l.218-.474Z" />
                </svg>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="flex-grow overflow-y-auto">
            <!-- Workflow Configuration Section -->
            <section class="py-3 px-4 border-b border-custom-line">
                <h2 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Workflow Configuration</h2>

                <div class="grid grid-cols-2 items-start justify-around gap-8">
                    <!-- IDE Group -->
                    <div class="flex flex-col items-center">
                        <h3 class="text-xs font-bold text-gray-300 mb-2">IDE</h3>
                        <div class="flex justify-between w-full px-2">
                            <div id="new-issues-toggle"
                                class="flex flex-col items-center space-y-1 p-2 text-center cursor-pointer opacity-40">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M10 3L8 8l-5 2 5 2 2 5 2-5 5-2-5-2-2-5Z" />
                                    <path d="M16.38 13.62a2.63 2.63 0 1 1 3.72 3.72 2.63 2.63 0 0 1-3.72-3.72Z" />
                                </svg>
                                <span class="text-xs font-medium">New Issues</span>
                            </div>
                            <div class="flex flex-col items-center space-y-1 p-2 text-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="text-gray-300">
                                    <path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18" />
                                    <path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2" />
                                    <path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2" />
                                    <path d="M10 6h4" />
                                    <path d="M10 10h4" />
                                    <path d="M10 14h4" />
                                    <path d="M10 18h4" />
                                </svg>
                                <span class="text-xs font-medium text-gray-300">Auto Org</span>
                            </div>
                            <div class="flex flex-col items-center space-y-1 p-2 opacity-40 text-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="text-gray-500">
                                    <circle cx="11" cy="11" r="8" />
                                    <path d="m21 21-4.3-4.3" />
                                </svg>
                                <span class="text-xs font-medium text-gray-500">Auto Scan</span>
                            </div>
                            <div class="flex flex-col items-center space-y-1 p-2 opacity-40 text-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="text-gray-500">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                                <span class="text-xs font-medium text-gray-500">Commit Hooks</span>
                            </div>
                        </div>
                    </div>

                    <!-- Agent Group -->
                    <div class="flex flex-col items-center border-l border-custom-line pl-8">
                        <h3 class="text-xs font-bold text-gray-300 mb-2">AGENT</h3>
                        <div class="flex items-start justify-between w-full px-2">
                            <div class="flex flex-col items-center space-y-1 p-2 text-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="text-gray-300">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <span class="text-xs font-medium text-gray-300">MCP Tools</span>
                            </div>
                            <div id="secure-toggle"
                                class="flex flex-col items-center space-y-1 p-2 text-center cursor-pointer opacity-40">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="text-gray-300">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                                <span class="text-xs font-medium text-gray-300 whitespace-nowrap">Secure At
                                    Inception</span>
                            </div>
                            <div id="custom-rules-container"
                                class="flex flex-col items-center space-y-1 p-2 text-center opacity-40 pointer-events-none">
                                <div class="flex items-center bg-custom-dark p-1 rounded-md text-xs">
                                    <span class="px-2 py-0.5 rounded-md">Manual</span>
                                    <span class="px-2 py-0.5 rounded-md">Automatic</span>
                                    <span class="px-2 py-0.5 rounded-md bg-gray-600 text-white">Always</span>
                                </div>
                                <span class="text-xs font-medium text-gray-400 mt-2">Apply Custom Rules</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Security Findings Section -->
            <section class="p-4 border-b border-custom-line">
                <h2 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">Security Findings</h2>
                <!-- Filters & Group By -->
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center space-x-1 bg-[#2d333b] p-1 rounded-md text-xs w-fit">
                        <label id="severity-toggle"
                            class="cursor-pointer px-3 py-1 rounded-md bg-gray-700 text-white font-semibold">Severity</label>
                        <label id="scan-type-toggle"
                            class="cursor-pointer px-3 py-1 rounded-md text-gray-400 hover:bg-gray-700/50">Scan
                            Type</label>
                    </div>

                    <div class="flex items-center gap-4 text-xs text-gray-300">
                        <div class="flex items-center">
                            <input id="reachable" type="checkbox"
                                class="h-4 w-4 rounded bg-gray-700 border-gray-600 text-gray-500 focus:ring-gray-600">
                            <label for="reachable" class="ml-2">Reachable</label>
                        </div>
                        <div class="flex items-center">
                            <input id="autofixable" type="checkbox"
                                class="h-4 w-4 rounded bg-gray-700 border-gray-600 text-gray-500 focus:ring-gray-600">
                            <label for="autofixable" class="ml-2">Autofixable</label>
                        </div>
                        <div class="flex items-center">
                            <input id="ignored" type="checkbox"
                                class="h-4 w-4 rounded bg-gray-700 border-gray-600 text-gray-500 focus:ring-gray-600">
                            <label for="ignored" class="ml-2">Ignored</label>
                        </div>
                        <div class="flex items-center">
                            <input type="number" value="800"
                                class="w-16 bg-gray-700 border-gray-600 rounded-md p-1 text-xs text-center">
                            <label class="ml-2">Risk Score</label>
                        </div>
                    </div>
                </div>

                <div
                    class="flex justify-between items-center mb-2 text-xs text-gray-400 font-bold uppercase tracking-wider">
                    <div id="group-by-header" class="flex-1">Severity</div>
                    <div class="w-28 text-right flex items-center justify-end gap-1 relative has-tooltip">
                        <span>Risk Score</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="text-gray-500">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                        <div
                            class="tooltip absolute bottom-full mb-2 w-64 bg-black text-white text-xs rounded py-2 px-3 right-0 transform transition-all duration-200 invisible opacity-0 -translate-y-2">
                            Snyk Risk Score is a single value assigned to an issue, applied by automatic risk analysis
                            for all vulnerability-type issues. Risk Score is based on the potential impact and
                            likelihood of exploitability.
                            <svg class="absolute text-black h-2 w-full left-0 top-full" x="0px" y="0px"
                                viewBox="0 0 255 255" xml:space="preserve">
                                <polygon class="fill-current" points="0,0 127.5,127.5 255,0" />
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Findings container -->
                <div id="findings-container">
                    <!-- Severity View (content generated by JS) -->
                    <div id="severity-view" class="space-y-1"></div>
                    <!-- Scan Type View (content generated by JS) -->
                    <div id="scan-type-view" class="space-y-1" style="display: none;"></div>
                </div>
            </section>

            <!-- Notifications & Tasks Section -->
            <section class="p-4">
                <h2 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">Notifications & Tasks</h2>
                <div class="space-y-1">
                    <!-- Notification Item -->
                    <div class="p-2 rounded-lg flex items-start gap-3 hover:bg-custom-dark transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="text-purple-400 mt-0.5 flex-shrink-0">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                        </svg>
                        <p class="text-sm text-gray-300">You have been assigned the <span
                                class="font-semibold text-white">OWASP Top 10</span> learning path in <span
                                class="font-semibold text-white">Snyk Learn</span>. <a href="#"
                                class="text-indigo-400 font-semibold hover:underline ml-2">Start Learning →</a></p>
                    </div>
                    <!-- Notification Item -->
                    <div class="p-2 rounded-lg flex items-start gap-3 hover:bg-custom-dark transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="text-green-500 mt-0.5 flex-shrink-0">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                        <p class="text-sm text-gray-300">Your ignore for <span
                                class="font-semibold text-white">Prototype Pollution minimist@1.2.5</span> was approved
                            by <span class="font-semibold text-white">Jane Doe</span>. <a href="#"
                                class="text-indigo-400 font-semibold hover:underline ml-2">View Finding →</a></p>
                    </div>
                    <!-- Notification Item -->
                    <div class="p-2 rounded-lg flex items-start gap-3 hover:bg-custom-dark transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="text-blue-500 mt-0.5 flex-shrink-0">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        </svg>
                        <p class="text-sm text-gray-300"><span class="font-semibold text-white">3 high severity
                                issues</span> were automatically resolved by <span
                                class="font-semibold text-white">Remediation Agent</span> in <span
                                class="font-mono text-xs bg-custom-dark px-1 py-0.5 rounded">package.json</span>. <a
                                href="#" class="text-indigo-400 font-semibold hover:underline ml-2">Review Pull Request
                                →</a></p>
                    </div>
                    <!-- Notification Item -->
                    <div class="p-2 rounded-lg flex items-start gap-3 hover:bg-custom-dark transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="text-gray-400 mt-0.5 flex-shrink-0">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <p class="text-sm text-gray-300"><span class="font-semibold text-white">Snyk MCP server</span>
                            has now been configured for <span class="font-semibold text-white">Copilot</span></p>
                    </div>
                    <!-- Notification Item -->
                    <div class="p-2 rounded-lg flex items-start gap-3 hover:bg-custom-dark transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="text-yellow-500 mt-0.5 flex-shrink-0">
                            <path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                        <p class="text-sm text-gray-300"><span class="font-semibold text-white">Commit hooks</span> were
                            disabled. We removed the local git hook from the <span
                                class="font-mono text-xs bg-custom-dark px-1 py-0.5 rounded">registry</span> repository
                        </p>
                    </div>
                </div>
            </section>
        </div>

        <!-- Footer Section -->
        <footer class="p-4 border-t border-custom-line bg-custom-darker">
            <div class="flex items-center justify-between text-xs text-gray-300">
                <div class="flex items-center gap-6">
                    <div class="flex items-center">
                        <span class="text-gray-400 mr-2">Org</span>
                        <div class="flex items-center bg-custom-dark rounded-md px-3 py-1">
                            <span class="font-semibold">Snyk Demo Org</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="ml-2 text-gray-400">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <span class="text-gray-400 mr-2">User</span>
                        <div class="flex items-center bg-custom-dark rounded-md px-3 py-1">
                            <span class="font-semibold">jeff.andersen@snyk.io</span>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DATA ---
            const allFindings = [
                { id: 1, title: 'Hardcoded Non-Cryptographic Secret', severity: 'High', type: 'Code', risk: 895, file: 'server/routes.js:23', isNew: false, isAutofixable: false, isReachable: false, isIgnored: false },
                { id: 2, title: 'SQL Injection', severity: 'High', type: 'Code', risk: 880, file: 'db/queries.js:112', isNew: true, isAutofixable: true, isReachable: true, isIgnored: false },
                { id: 3, title: 'Cross-site Scripting (XSS)', severity: 'High', type: 'Code', risk: 872, file: 'views/login.ejs:12', isNew: true, isAutofixable: true, isReachable: true, isIgnored: false },
                { id: 4, title: 'Regular Expression Denial of Service', severity: 'High', type: 'Open Source', risk: 860, file: 'lodash@4.17.20', isNew: false, isAutofixable: false, isReachable: false, isIgnored: true },
                { id: 5, title: 'Path Traversal', severity: 'Medium', type: 'Code', risk: 830, file: 'utils/filehandler.js:45', isNew: false, isAutofixable: false, isReachable: false, isIgnored: false },
                { id: 6, title: 'Prototype Pollution', severity: 'Medium', type: 'Open Source', risk: 815, file: 'minimist@1.2.5', isNew: false, isAutofixable: false, isReachable: true, isIgnored: true },
                { id: 7, title: 'Prototype Pollution', severity: 'Medium', type: 'Open Source', risk: 805, file: 'yargs-parser@13.1.2', isNew: true, isAutofixable: false, isReachable: true, isIgnored: false },
            ];

            // --- STATE ---
            const state = {
                groupBy: 'severity', // 'severity' or 'scan-type'
                showNewOnly: false
            };

            // --- DOM ELEMENTS ---
            const newIssuesToggle = document.getElementById('new-issues-toggle');
            const secureToggle = document.getElementById('secure-toggle');
            const customRulesContainer = document.getElementById('custom-rules-container');
            const severityToggle = document.getElementById('severity-toggle');
            const scanTypeToggle = document.getElementById('scan-type-toggle');
            const severityView = document.getElementById('severity-view');
            const scanTypeView = document.getElementById('scan-type-view');
            const groupByHeader = document.getElementById('group-by-header');

            // --- RENDER FUNCTIONS ---

            const getSeverityIcon = (severity) => {
                if (severity === 'High') {
                    return `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-500 mt-0.5"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>`;
                }
                return `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-400 mt-0.5"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>`;
            };

            const getSeverityClass = (severity) => {
                return severity === 'High' ? 'text-red-500' : 'text-orange-400';
            }

            const createFindingHtml = (finding) => {
                const isIgnoredClass = finding.isIgnored ? 'opacity-60' : '';
                const reachableIcon = finding.isReachable ? `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-400 ml-2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>` : '';
                const autofixableIcon = finding.isAutofixable ? `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-400 ml-2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>` : '';

                let subtitle = '';
                if (state.groupBy === 'severity') {
                    subtitle = `${finding.file} <span class="text-gray-500 mx-1">•</span> <span class="text-gray-300 font-medium">${finding.type}</span>`;
                } else { // scan-type
                    subtitle = `${finding.file} <span class="text-gray-500 mx-1">•</span> <span class="${getSeverityClass(finding.severity)} font-medium">${finding.severity}</span>`;
                }
                if (finding.isReachable && state.groupBy === 'severity') subtitle += ` <span class="text-gray-500 mx-1">•</span> Reachable`;
                if (finding.isIgnored) subtitle += ` <span class="text-gray-500 mx-1">•</span> Ignored`;


                return `
                    <div class="py-1 px-3 rounded-lg flex items-center gap-2 hover:bg-custom-dark transition-colors finding-item ${isIgnoredClass}">
                        <div class="flex-grow flex items-start">
                            ${getSeverityIcon(finding.severity)}
                            <div class="ml-3">
                                <div class="flex items-center">
                                    <span class="text-white font-medium text-sm">${finding.title}</span>
                                    ${reachableIcon}
                                    ${autofixableIcon}
                                </div>
                                <p class="text-xs text-gray-400 mt-1">${subtitle}</p>
                            </div>
                        </div>
                        <div class="w-28 text-right text-base font-normal text-gray-400">${finding.risk}</div>
                    </div>
                `;
            };

            const render = () => {
                // 1. Filter data based on state
                const findingsToShow = state.showNewOnly
                    ? allFindings.filter(f => f.isNew)
                    : allFindings;

                // 2. Group data
                if (state.groupBy === 'severity') {
                    const groupedBySeverity = findingsToShow.reduce((acc, finding) => {
                        (acc[finding.severity] = acc[finding.severity] || []).push(finding);
                        return acc;
                    }, {});

                    severityView.innerHTML = Object.entries(groupedBySeverity).map(([severity, items]) => `
                        <div>
                            <div class="flex items-center py-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 mr-2"><polyline points="6 9 12 15 18 9"></polyline></svg>
                                <h3 class="font-semibold ${getSeverityClass(severity)} text-sm">${severity} (${items.length})</h3>
                            </div>
                            <div class="space-y-0">${items.map(createFindingHtml).join('')}</div>
                        </div>
                    `).join('');

                } else { // scan-type
                    const groupedByType = findingsToShow.reduce((acc, finding) => {
                        (acc[finding.type] = acc[finding.type] || []).push(finding);
                        return acc;
                    }, {});

                    scanTypeView.innerHTML = Object.entries(groupedByType).map(([type, items]) => `
                        <div>
                             <div class="flex items-center py-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 mr-2"><polyline points="6 9 12 15 18 9"></polyline></svg>
                                <h3 class="font-semibold text-gray-300 text-sm">${type} (${items.length})</h3>
                            </div>
                            <div class="space-y-0">${items.map(createFindingHtml).join('')}</div>
                        </div>
                    `).join('');
                }

                // 3. Update view visibility
                severityView.style.display = state.groupBy === 'severity' ? 'block' : 'none';
                scanTypeView.style.display = state.groupBy === 'scan-type' ? 'block' : 'none';
                groupByHeader.textContent = state.groupBy === 'severity' ? 'Severity' : 'Scan Type';
            };

            // --- EVENT LISTENERS ---

            if (newIssuesToggle) {
                newIssuesToggle.addEventListener('click', () => {
                    state.showNewOnly = !state.showNewOnly;
                    newIssuesToggle.classList.toggle('workflow-active');
                    newIssuesToggle.classList.toggle('opacity-40');
                    render();
                });
            }

            if (secureToggle) {
                secureToggle.addEventListener('click', () => {
                    const isNowActive = !secureToggle.classList.toggle('opacity-40');
                    if (isNowActive) {
                        customRulesContainer.classList.remove('opacity-40', 'pointer-events-none');
                    } else {
                        customRulesContainer.classList.add('opacity-40', 'pointer-events-none');
                    }
                });
            }

            if (scanTypeToggle) {
                scanTypeToggle.addEventListener('click', () => {
                    state.groupBy = 'scan-type';
                    scanTypeToggle.classList.add('bg-gray-700', 'text-white', 'font-semibold');
                    scanTypeToggle.classList.remove('text-gray-400', 'hover:bg-gray-700/50');
                    severityToggle.classList.remove('bg-gray-700', 'text-white', 'font-semibold');
                    severityToggle.classList.add('text-gray-400', 'hover:bg-gray-700/50');
                    render();
                });
            }

            if (severityToggle) {
                severityToggle.addEventListener('click', () => {
                    state.groupBy = 'severity';
                    severityToggle.classList.add('bg-gray-700', 'text-white', 'font-semibold');
                    severityToggle.classList.remove('text-gray-400', 'hover:bg-gray-700/50');
                    scanTypeToggle.classList.remove('bg-gray-700', 'text-white', 'font-semibold');
                    scanTypeToggle.classList.add('text-gray-400', 'hover:bg-gray-700/50');
                    render();
                });
            }

            // --- INITIAL RENDER ---
            render();
        });
    </script>
</body>

</html>